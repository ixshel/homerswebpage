name: Notify MS Teams on PR Merge

on:
  pull_request:
    types:
      - closed

jobs:
  notify-teams:
    if: github.event.pull_request.merged == true
    runs-on: ubuntu-latest
    steps:
      - name: Set Tier Label Based on Branch
        run: |
          if [[ "${{ github.event.pull_request.base.ref }}" == "main" ]]; then
            echo "TIER=ðŸš€ **Production (Main)**" >> $GITHUB_ENV
          elif [[ "${{ github.event.pull_request.base.ref }}" == "staging" ]]; then
            echo "TIER=ðŸ› ï¸ **Staging**" >> $GITHUB_ENV
          elif [[ "${{ github.event.pull_request.base.ref }}" == "develop" ]]; then
            echo "TIER=ðŸ”§ **Development**" >> $GITHUB_ENV
          else
            echo "TIER=Unknown Environment" >> $GITHUB_ENV
          fi

      - name: Send Notification to MS Teams
        run: |
          curl -H "Content-Type: application/json" -d '{
            "text": "âœ… A pull request has been merged!\n\n**ðŸ”¹ Environment:** '${{ env.TIER }}'\nðŸ”¹ **Repository:** '${{ github.repository }}'\nðŸ”¹ **PR Title:** '${{ github.event.pull_request.title }}'\nðŸ”¹ **Merged By:** '${{ github.event.pull_request.merged_by.login }}'\nðŸ”¹ **PR Link:** '${{ github.event.pull_request.html_url }}'"
          }' ${{ secrets.TEAMS_WEBHOOK_URL }}
